<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="UTF-8">
    <title>Spare Parts Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3498db',
                        secondary: '#2c3e50',
                        accent: '#e74c3c',
                        success: '#27ae60',
                        warning: '#f39c12',
                        purple: '#9b59b6'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'pulse-glow': 'pulseGlow 2s infinite'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        @keyframes pulseGlow {
            0% { transform: scale(1); box-shadow: 0 0 20px rgba(231, 76, 60, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(231, 76, 60, 0.5); }
            100% { transform: scale(1); box-shadow: 0 0 20px rgba(231, 76, 60, 0.3); }
        }
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        /* Loading States */
        .loading {
            position: relative;
            pointer-events: none;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 2px solid #3498db;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        
        /* Search highlighting */
        .search-results-highlight {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
          /* Custom animations for the dashboard */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        /* Mobile responsiveness improvements */
        @media (max-width: 768px) {
            .items-container {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header-text {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
                width: 100%;
            }
            
            .button-group button {
                width: 100%;
                margin-bottom: 0.5rem;
            }
        }

        /* Image upload styles */
        .image-upload-area {
            transition: all 0.3s ease;
        }
        
        .image-upload-area:hover {
            border-color: #3498db;
            background-color: #f8fafc;
        }

        /* Loading spinner */
        .loading::after {
            border-color: #3498db transparent #3498db transparent;
        }</style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-500 via-purple-500 to-indigo-600">
    <!-- Mobile Menu Button -->
    <button id="mobile-menu-button" class="fixed top-4 left-4 z-50 md:hidden bg-gray-800 text-white p-3 rounded-lg shadow-lg hover:bg-gray-700 transition-all duration-300">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"></div>

    <!-- Main Container -->
    <div class="flex min-h-screen">
        <!-- Responsive Sidebar -->
        <div id="sidebar" class="fixed md:relative transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out z-40 w-72 bg-gradient-to-b from-gray-800 via-gray-900 to-black text-white shadow-2xl h-full overflow-y-auto">
            <div class="p-6">
                <!-- Sidebar Header -->
                <div class="mb-8 text-center relative">
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                        Dashboard
                    </h2>
                    <!-- Close button for mobile -->
                    <button id="close-mobile-menu" class="absolute top-0 right-0 md:hidden text-white hover:text-gray-300 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- User Info Section -->
                <div class="mb-6 p-4 bg-gray-700/50 rounded-xl">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full flex items-center justify-center">
                            <span class="text-white font-bold text-sm" th:text="${username != null ? #strings.substring(username, 0, 1) : 'U'}">U</span>
                        </div>
                        <div>
                            <div class="text-white font-semibold text-sm" th:text="${username ?: 'User'}">User</div>
                            <div class="text-gray-300 text-xs" th:text="${userRole ?: 'USER'}">USER</div>
                            <span th:if="${isAdmin}" class="bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold">ADMIN</span>
                        </div>
                    </div>
                </div>
                
                <!-- Navigation -->
                <nav class="space-y-3">
                    <div class="nav-item active bg-gradient-to-r from-primary to-purple text-white px-4 py-3 rounded-xl cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-lg" data-section="overview">
                        <div class="flex items-center space-x-3">
                            <span>üìä</span>
                            <span class="font-medium">Overview</span>
                        </div>
                    </div>                    <div class="nav-item px-4 py-3 rounded-xl cursor-pointer transition-all duration-300 hover:bg-gray-700 hover:scale-105" data-section="items">
                        <div class="flex items-center space-x-3">
                            <span>üì¶</span>
                            <span class="font-medium">Items</span>
                            <span id="items-count-badge" class="ml-auto bg-blue-500 text-white text-xs px-2 py-1 rounded-full">...</span>
                        </div>
                    </div>
                    <div class="nav-item px-4 py-3 rounded-xl cursor-pointer transition-all duration-300 hover:bg-gray-700 hover:scale-105" data-section="analytics">
                        <div class="flex items-center space-x-3">
                            <span>üìà</span>
                            <span class="font-medium">Analytics</span>
                        </div>
                    </div>
                    <div class="nav-item px-4 py-3 rounded-xl cursor-pointer transition-all duration-300 hover:bg-gray-700 hover:scale-105" data-section="settings">
                        <div class="flex items-center space-x-3">
                            <span>‚öôÔ∏è</span>
                            <span class="font-medium">Settings</span>
                        </div>
                    </div>
                    
                    <!-- Admin Only Section -->
                    <div sec:authorize="hasRole('ADMIN')" class="border-t border-gray-600 pt-4 mt-4">
                        <div class="text-xs text-gray-400 uppercase tracking-wider mb-3 px-4">Admin Tools</div>
                        <div class="nav-item px-4 py-3 rounded-xl cursor-pointer transition-all duration-300 hover:bg-gray-700 hover:scale-105" data-section="admin">
                            <div class="flex items-center space-x-3">
                                <span>üîê</span>
                                <span class="font-medium">Admin Panel</span>
                            </div>
                        </div>
                        <div class="nav-item px-4 py-3 rounded-xl cursor-pointer transition-all duration-300 hover:bg-gray-700 hover:scale-105" data-section="users">
                            <div class="flex items-center space-x-3">
                                <span>üë•</span>
                                <span class="font-medium">User Management</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="border-t border-gray-600 pt-4 mt-4">
                        <div class="text-xs text-gray-400 uppercase tracking-wider mb-3 px-4">Quick Actions</div>
                        <button id="quick-add-item" class="w-full nav-item px-4 py-3 rounded-xl cursor-pointer transition-all duration-300 hover:bg-green-600 hover:scale-105 bg-green-500 text-white mb-2">
                            <div class="flex items-center space-x-3">
                                <span>‚ûï</span>
                                <span class="font-medium">Add Item</span>
                            </div>
                        </button>
                        <button id="quick-search" class="w-full nav-item px-4 py-3 rounded-xl cursor-pointer transition-all duration-300 hover:bg-blue-600 hover:scale-105 bg-blue-500 text-white">
                            <div class="flex items-center space-x-3">
                                <span>üîç</span>
                                <span class="font-medium">Search Items</span>
                            </div>
                        </button>
                    </div>
                    
                    <hr class="my-6 border-gray-600">
                    
                    <!-- Logout Button -->
                    <div class="nav-item logout bg-gradient-to-r from-accent to-red-600 px-4 py-3 rounded-xl cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-lg" onclick="logout()">
                        <div class="flex items-center space-x-3">
                            <span>üö™</span>
                            <span class="font-medium">Logout</span>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
          <!-- Main Content Area - Responsive -->
        <div class="flex-1 md:ml-0 p-4 md:p-8 bg-white/95 backdrop-blur-sm overflow-y-auto min-h-screen">
            <!-- Header - Mobile Responsive -->
            <div class="bg-white rounded-2xl p-4 md:p-8 mb-6 md:mb-8 shadow-xl border border-white/50">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                    <div class="mb-6 lg:mb-0">
                        <h1 class="header-text text-2xl md:text-4xl font-bold bg-gradient-to-r from-primary to-purple bg-clip-text text-transparent mb-2">
                            Spare Parts Dashboard
                        </h1>
                        <div class="flex flex-col sm:flex-row sm:items-center gap-4 text-sm text-gray-600">
                            <div class="bg-gray-100 px-4 py-2 rounded-full font-semibold">
                                Welcome, <span id="username-display" th:text="${username ?: 'User'}">User</span>!
                                <span th:if="${isAdmin}" class="ml-2 bg-red-100 text-red-700 px-2 py-1 rounded-full text-xs font-bold">ADMIN</span>
                            </div>
                            <div class="text-xs sm:text-sm">Last Updated: <span id="last-updated" class="font-semibold"></span></div>
                            <div class="flex items-center gap-2">
                                <div id="db-status" class="w-3 h-3 rounded-full bg-gray-400"></div>
                                <span id="db-status-text" class="text-xs">Connecting...</span>
                            </div>
                        </div>
                    </div>                    
                    <!-- Search Container - Mobile Responsive -->
                    <div class="flex flex-col sm:flex-row gap-3">
                        <input type="text" 
                               id="search-bar" 
                               placeholder="üîç Search items by name, description, or ID..."
                               class="px-4 md:px-6 py-3 border-2 border-gray-200 rounded-full focus:border-primary focus:ring-0 focus:outline-none transition-all duration-300 text-sm w-full sm:w-80">
                        
                        <div class="button-group flex flex-col sm:flex-row gap-2">
                            <button id="search-button" 
                                    class="bg-gradient-to-r from-primary to-blue-600 hover:from-blue-600 hover:to-primary text-white px-4 md:px-6 py-3 rounded-full font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl text-sm">
                                üîç <span class="hidden sm:inline">Search</span>
                            </button>
                            <button id="clear-search-button" 
                                    class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-4 md:px-6 py-3 rounded-full font-semibold transition-all duration-300 transform hover:scale-105 text-sm">
                                ‚úñ <span class="hidden sm:inline">Clear</span>
                            </button>
                            <button class="md:hidden bg-gradient-to-r from-accent to-red-600 hover:from-red-600 hover:to-accent text-white px-4 py-3 rounded-full font-semibold transition-all duration-300 transform hover:scale-105 text-sm" onclick="logout()">
                                üö™
                            </button>
                            <button class="bg-gradient-to-r from-accent to-red-600 hover:from-red-600 hover:to-accent text-white px-6 py-3 rounded-full font-semibold transition-all duration-300 transform hover:scale-105 text-sm" onclick="logout()">
                                üö™ Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
              <!-- Stats Grid -->            <div class="stats-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8" id="stats-section">
                <div class="bg-white rounded-2xl p-6 shadow-xl border border-white/50 text-center transform transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                    <h3 class="text-sm font-bold text-gray-600 uppercase tracking-wider mb-4">Total Items</h3>
                    <div class="text-4xl font-black bg-gradient-to-r from-primary to-purple bg-clip-text text-transparent" id="total-items">...</div>
                </div>
                <div class="bg-white rounded-2xl p-6 shadow-xl border border-white/50 text-center transform transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                    <h3 class="text-sm font-bold text-gray-600 uppercase tracking-wider mb-4">Total Value</h3>
                    <div class="text-4xl font-black bg-gradient-to-r from-success to-green-600 bg-clip-text text-transparent" id="total-value">...</div>
                </div>
                <div class="bg-white rounded-2xl p-6 shadow-xl border border-white/50 text-center transform transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                    <h3 class="text-sm font-bold text-gray-600 uppercase tracking-wider mb-4">Low Stock Items</h3>
                    <div class="text-4xl font-black bg-gradient-to-r from-accent to-red-600 bg-clip-text text-transparent" id="low-stock">...</div>
                </div>
                <div class="bg-white rounded-2xl p-6 shadow-xl border border-white/50 text-center transform transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                    <h3 class="text-sm font-bold text-gray-600 uppercase tracking-wider mb-4">Average Price</h3>
                    <div class="text-4xl font-black bg-gradient-to-r from-warning to-yellow-600 bg-clip-text text-transparent" id="avg-price">...</div>
                </div>
            </div>
            
            <!-- Search Results Message -->
            <div id="search-results-container"></div>              <!-- Items Grid -->
            <div class="items-container grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6 mb-6 md:mb-8" id="items-container">
                <div th:each="item : ${spareparts}" class="bg-white rounded-2xl p-6 shadow-xl border border-white/50 transform transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-xl font-bold text-secondary item-name" th:text="${item.name}">Item Name</h3>
                        <div class="flex items-center">
                            <span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs font-semibold item-id" th:text="'ID: ' + ${item.id}">ID: 0</span>                            <div class="ml-2 flex items-center" th:if="${isAdmin}">
                                <button th:data-item-id="${item.id}"
                                        th:data-item-name="${item.name}"
                                        th:data-item-description="${item.description}"
                                        th:data-item-price="${item.price}"
                                        th:data-item-quantity="${item.quantity}"
                                        th:data-item-currency="${item.currency ?: 'USD'}"
                                        th:data-item-image-path="${item.imagePath ?: ''}"
                                        onclick="openUpdateModalFromData(this)"
                                        class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-3 py-1 rounded-lg text-xs font-semibold transition-all duration-300 transform hover:scale-105 mr-2">
                                    ‚úèÔ∏è Update
                                </button>
                                <button th:data-item-id="${item.id}"
                                        th:data-item-name="${item.name}"
                                        onclick="deleteItemFromData(this)"
                                        class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-3 py-1 rounded-lg text-xs font-semibold transition-all duration-300 transform hover:scale-105">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Image Display -->
                    <div class="mb-4 flex justify-center">
                        <div th:if="${item.imagePath != null and item.imagePath != ''}" class="relative">
                            <img th:src="@{'/uploads/' + ${item.imagePath}}" 
                                 th:alt="${item.name}"
                                 class="w-full h-48 object-cover rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300"
                                 onerror="this.parentElement.innerHTML='<div class=\'w-full h-48 bg-gray-200 rounded-lg flex items-center justify-center\'><span class=\'text-gray-500\'>üì¶ No Image</span></div>'">
                        </div>
                        <div th:unless="${item.imagePath != null and item.imagePath != ''}" 
                             class="w-full h-48 bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg flex items-center justify-center">
                            <span class="text-gray-500 text-lg">üì¶ No Image</span>
                        </div>
                    </div>
                    
                    <p class="text-gray-600 mb-4 item-description" th:text="${item.description}">Item description</p>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-gradient-to-r from-success to-green-600 text-white p-3 rounded-xl text-center">
                            <div class="text-xs font-semibold opacity-90">üí∞ Price</div>
                            <div class="text-lg font-bold item-price" th:text="${item.currency ?: 'USD'} + ' ' + ${#numbers.formatDecimal(item.price, 1, 2)}">$0.00</div>
                        </div>
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-3 rounded-xl text-center">
                            <div class="text-xs font-semibold opacity-90">üì¶ Stock</div>
                            <div class="text-lg font-bold item-quantity" th:text="${item.quantity}">0</div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500">Available in Stock</span>
                        <div class="flex items-center">
                            <div th:if="${item.quantity > 10}" class="h-2 w-2 bg-success rounded-full mr-2"></div>
                            <div th:if="${item.quantity <= 10 and item.quantity > 0}" class="h-2 w-2 bg-warning rounded-full mr-2"></div>
                            <div th:if="${item.quantity <= 0}" class="h-2 w-2 bg-accent rounded-full mr-2"></div>
                            <span th:if="${item.quantity > 10}" class="text-xs font-semibold text-success">In Stock</span>
                            <span th:if="${item.quantity <= 10 and item.quantity > 0}" class="text-xs font-semibold text-warning">Low Stock</span>
                            <span th:if="${item.quantity <= 0}" class="text-xs font-semibold text-accent">Out of Stock</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Add Item Form -->            <div class="bg-white rounded-2xl p-8 shadow-xl border border-white/50 mb-8">
                <h2 class="text-2xl font-bold text-center text-secondary mb-8">üì¶ Add New Item to Stock</h2>
                <form id="add-item-form" class="form-grid grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6" enctype="multipart/form-data">
                    <input type="text" 
                           id="item-name" 
                           placeholder="Item Name" 
                           required 
                           class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-success focus:ring-0 focus:outline-none transition-colors duration-300">
                    
                    <input type="text" 
                           id="item-description" 
                           placeholder="Item Description" 
                           required 
                           class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-success focus:ring-0 focus:outline-none transition-colors duration-300">
                    
                    <input type="number" 
                           id="item-price" 
                           placeholder="Price" 
                           step="0.01" 
                           min="0" 
                           required 
                           class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-success focus:ring-0 focus:outline-none transition-colors duration-300">
                      <input type="number" 
                           id="item-quantity" 
                           placeholder="Quantity" 
                           min="1" 
                           required 
                           class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-success focus:ring-0 focus:outline-none transition-colors duration-300">
                    
                    <select id="item-currency" 
                            class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-success focus:ring-0 focus:outline-none transition-colors duration-300">
                        <option value="LKR">LKR (Sri Lankan Rupee)</option>
                        <option value="USD">USD (US Dollar)</option>
                        <option value="EUR">EUR (Euro)</option>
                        <option value="GBP">GBP (British Pound)</option>
                    </select>
                    
                    <!-- Image Upload Section -->
                    <div class="md:col-span-2">
                        <label for="item-image" class="block text-sm font-medium text-gray-700 mb-2">üì∑ Item Image (Optional)</label>
                        <div class="flex items-center justify-center w-full">
                            <label for="item-image" class="image-upload-area flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-xl cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors duration-300">
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <svg class="w-8 h-8 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                                    </svg>
                                    <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                                    <p class="text-xs text-gray-500">PNG, JPG or GIF (MAX. 5MB)</p>
                                </div>
                                <input id="item-image" type="file" class="hidden" accept="image/*" />
                            </label>
                        </div>
                        <div id="image-preview" class="mt-4 hidden">
                            <img id="preview-img" src="" alt="Preview" class="max-w-full h-32 object-cover rounded-lg border-2 border-gray-200">
                            <button type="button" onclick="clearImagePreview()" class="mt-2 text-sm text-red-600 hover:text-red-800">Remove Image</button>
                        </div>
                    </div>
                    
                    <button type="submit" 
                            class="md:col-span-2 bg-gradient-to-r from-success to-green-600 hover:from-green-600 hover:to-success text-white py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                        Add Item to Stock
                    </button>
                </form>
            </div>
            
            <!-- Analytics Section -->
            <div id="analytics-section" class="hidden bg-white rounded-2xl p-8 shadow-xl border border-white/50">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-secondary">üìà Analytics & Future Insights</h2>
                </div>
                
                <!-- Charts Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="bg-gray-50 rounded-xl p-6 text-center shadow-lg">
                        <h3 class="text-lg font-bold text-secondary mb-4 uppercase tracking-wider">Stock Distribution</h3>
                        <canvas id="stockChart" width="300" height="200" class="max-w-full"></canvas>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-6 text-center shadow-lg">
                        <h3 class="text-lg font-bold text-secondary mb-4 uppercase tracking-wider">Price Analysis</h3>
                        <canvas id="priceChart" width="300" height="200" class="max-w-full"></canvas>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-6 text-center shadow-lg">
                        <h3 class="text-lg font-bold text-secondary mb-4 uppercase tracking-wider">Inventory Trends</h3>
                        <canvas id="trendChart" width="300" height="200" class="max-w-full"></canvas>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-6 text-center shadow-lg">
                        <h3 class="text-lg font-bold text-secondary mb-4 uppercase tracking-wider">Reorder Recommendations</h3>
                        <canvas id="reorderChart" width="300" height="200" class="max-w-full"></canvas>
                    </div>
                </div>
                
                <!-- Insights Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6">
                    <div class="bg-red-50 border-l-4 border-accent p-6 rounded-lg shadow-lg">
                        <h4 class="text-lg font-bold text-secondary mb-4">üö® Critical Actions Required</h4>
                        <div id="critical-content" class="text-sm text-gray-700">Loading insights...</div>
                    </div>
                    <div class="bg-yellow-50 border-l-4 border-warning p-6 rounded-lg shadow-lg">
                        <h4 class="text-lg font-bold text-secondary mb-4">‚ö†Ô∏è Attention Needed</h4>
                        <div id="warning-content" class="text-sm text-gray-700">Loading insights...</div>
                    </div>
                    <div class="bg-blue-50 border-l-4 border-primary p-6 rounded-lg shadow-lg">
                        <h4 class="text-lg font-bold text-secondary mb-4">üí° Strategic Recommendations</h4>
                        <div id="recommendation-content" class="text-sm text-gray-700">Loading insights...</div>
                    </div>
                    <div class="bg-purple-50 border-l-4 border-purple p-6 rounded-lg shadow-lg">
                        <h4 class="text-lg font-bold text-secondary mb-4">üîÆ Future Predictions</h4>
                        <div id="forecast-content" class="text-sm text-gray-700">Loading insights...</div>
                    </div>
                </div>
            </div>
        </div>    </div>
      <script>
        function openUpdateModalFromData(button) {
            const id = button.getAttribute('data-item-id');
            const name = button.getAttribute('data-item-name');
            const description = button.getAttribute('data-item-description');
            const price = button.getAttribute('data-item-price');
            const quantity = button.getAttribute('data-item-quantity');
            const currency = button.getAttribute('data-item-currency');
            const imagePath = button.getAttribute('data-item-image-path');
            openUpdateModal(id, name, description, price, quantity, currency, imagePath);
        }

        function deleteItemFromData(button) {
            const id = button.getAttribute('data-item-id');
            const name = button.getAttribute('data-item-name');
            deleteItem(id, name);
        }

        function openUpdateModal(id, name, description, price, quantity, currency, imagePath) {
            // Set form values
            document.getElementById('update-item-id').value = id;
            document.getElementById('update-item-name').value = name;
            document.getElementById('update-item-description').value = description;
            document.getElementById('update-item-price').value = price;
            document.getElementById('update-item-quantity').value = quantity;
            document.getElementById('update-item-currency').value = currency;
            
            // Clear and hide image preview
            clearUpdateImagePreview();
            
            if (imagePath) {
                document.getElementById('update-preview-img').src = '/uploads/' + imagePath;
                document.getElementById('update-image-preview').classList.remove('hidden');
            } else {
                document.getElementById('update-image-preview').classList.add('hidden');
            }
            
            // Show the modal
            document.getElementById('updateModal').classList.remove('hidden');
        }

        function closeUpdateModal() {
            document.getElementById('updateModal').classList.add('hidden');
            // Clear the form
            document.getElementById('update-item-form').reset();
            // Clear image preview
            clearUpdateImagePreview();
        }
        
        function clearUpdateImagePreview() {
            document.getElementById('update-item-image').value = '';
            document.getElementById('update-image-preview').classList.add('hidden');
            document.getElementById('update-preview-img').src = '';
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Create a form to submit POST request for logout
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/logout';
                
                // Add CSRF token if needed
                const csrfToken = document.querySelector('meta[name="_csrf"]');
                if (csrfToken) {
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = '_csrf';
                    csrfInput.value = csrfToken.getAttribute('content');
                    form.appendChild(csrfInput);
                }
                
                document.body.appendChild(form);
                form.submit();
            }        }
    </script>    <!-- Update Item Modal -->
    <div id="updateModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-2xl p-6 md:p-8 max-w-md w-full mx-4 shadow-2xl transform transition-all max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-secondary">‚úèÔ∏è Update Spare Part</h2>
                <button onclick="closeUpdateModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">√ó</button>
            </div>
              <form id="update-item-form" class="space-y-4" enctype="multipart/form-data">
                <input type="hidden" id="update-item-id">
                
                <input type="text" 
                       id="update-item-name" 
                       placeholder="Item Name" 
                       required 
                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-0 focus:outline-none transition-colors duration-300">
                
                <textarea id="update-item-description" 
                         placeholder="Item Description" 
                         required 
                         rows="3"
                         class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-0 focus:outline-none transition-colors duration-300"></textarea>
                
                <input type="number" 
                       id="update-item-price" 
                       placeholder="Price" 
                       step="0.01" 
                       min="0" 
                       required 
                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-0 focus:outline-none transition-colors duration-300">
                       
                <input type="number" 
                       id="update-item-quantity" 
                       placeholder="Quantity" 
                       min="0" 
                       required 
                       class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-0 focus:outline-none transition-colors duration-300">
                
                <select id="update-item-currency" 
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-0 focus:outline-none transition-colors duration-300">
                    <option value="LKR">LKR (Sri Lankan Rupee)</option>
                    <option value="USD">USD (US Dollar)</option>
                    <option value="EUR">EUR (Euro)</option>
                    <option value="GBP">GBP (British Pound)</option>
                </select>

                <!-- Image Upload Section for Update -->
                <div class="w-full">
                    <label for="update-item-image" class="block text-sm font-medium text-gray-700 mb-2">üì∑ Update Item Image (Optional)</label>
                    <div class="flex items-center justify-center w-full">                            <label for="update-item-image" class="image-upload-area flex flex-col items-center justify-center w-full h-24 border-2 border-gray-300 border-dashed rounded-xl cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors duration-300">
                            <div class="flex flex-col items-center justify-center pt-3 pb-3">
                                <svg class="w-6 h-6 mb-2 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                                </svg>
                                <p class="text-xs text-gray-500"><span class="font-semibold">Click to upload new image</span></p>
                            </div>
                            <input id="update-item-image" type="file" class="hidden" accept="image/*" />
                        </label>
                    </div>
                    <div id="update-image-preview" class="mt-2 hidden">
                        <img id="update-preview-img" src="" alt="Preview" class="max-w-full h-20 object-cover rounded-lg border-2 border-gray-200">
                        <button type="button" onclick="clearUpdateImagePreview()" class="mt-1 text-xs text-red-600 hover:text-red-800">Remove Image</button>
                    </div>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="button" 
                            onclick="closeUpdateModal()"
                            class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-xl font-bold transition-colors duration-300">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white py-3 rounded-xl font-bold transition-all duration-300 transform hover:scale-105">
                        Update Item
                    </button>
                </div>
            </form>
        </div>
    </div>      <script th:inline="javascript">
        // Store admin status from server
        const isAdmin = /*[[${isAdmin}]]*/ false;
        const currentUser = /*[[${username}]]*/ 'User';
        const userRole = /*[[${userRole}]]*/ 'USER';
        
        console.log('üîí User Info:', { isAdmin, currentUser, userRole });

        // Initialize navigation functionality
        function initializeNavigation() {
            const navItems = document.querySelectorAll('.nav-item[data-section]');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    
                    // Remove active class from all nav items
                    navItems.forEach(nav => nav.classList.remove('active', 'bg-gradient-to-r', 'from-primary', 'to-purple', 'text-white'));
                    
                    // Add active class to clicked item
                    this.classList.add('active', 'bg-gradient-to-r', 'from-primary', 'to-purple', 'text-white');
                    
                    // Handle section switching
                    switch(section) {
                        case 'overview':
                            scrollToElement('stats-section');
                            break;
                        case 'items':
                            scrollToElement('items-container');
                            break;
                        case 'analytics':
                            document.getElementById('analytics-section').classList.remove('hidden');
                            loadAnalytics();
                            scrollToElement('analytics-section');
                            break;
                        default:
                            document.getElementById('analytics-section').classList.add('hidden');
                    }
                });
            });
        }

        // Initialize image upload functionality
        function initializeImageUpload() {
            const imageInput = document.getElementById('item-image');
            const previewContainer = document.getElementById('image-preview');
            const previewImg = document.getElementById('preview-img');
            
            if (imageInput) {
                imageInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        if (file.size > 5 * 1024 * 1024) { // 5MB limit
                            alert('File size must be less than 5MB');
                            this.value = '';
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewImg.src = e.target.result;
                            previewContainer.classList.remove('hidden');
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // Update modal image upload
            const updateImageInput = document.getElementById('update-item-image');
            const updatePreviewContainer = document.getElementById('update-image-preview');
            const updatePreviewImg = document.getElementById('update-preview-img');
            
            if (updateImageInput) {
                updateImageInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        if (file.size > 5 * 1024 * 1024) { // 5MB limit
                            alert('File size must be less than 5MB');
                            this.value = '';
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            updatePreviewImg.src = e.target.result;
                            updatePreviewContainer.classList.remove('hidden');
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        }

        // Utility function to scroll to element
        function scrollToElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Clear image preview function
        function clearImagePreview() {
            const imageInput = document.getElementById('item-image');
            const previewContainer = document.getElementById('image-preview');
            const previewImg = document.getElementById('preview-img');
            
            if (imageInput) imageInput.value = '';
            if (previewContainer) previewContainer.classList.add('hidden');
            if (previewImg) previewImg.src = '';
        }

        // Enhanced search functionality with highlighting
        function performSearch() {
            const query = document.getElementById('search-bar').value.toLowerCase().trim();
            const itemCards = document.querySelectorAll('#items-container > div');
            const resultsContainer = document.getElementById('search-results-container');
            let visibleCount = 0;
            
            itemCards.forEach(card => {
                const name = card.querySelector('.item-name')?.textContent.toLowerCase() || '';
                const description = card.querySelector('.item-description')?.textContent.toLowerCase() || '';
                const id = card.querySelector('.item-id')?.textContent.toLowerCase() || '';
                
                const isVisible = query === '' || name.includes(query) || description.includes(query) || id.includes(query);
                
                if (isVisible) {
                    card.style.display = '';
                    visibleCount++;
                    
                    // Highlight search terms
                    if (query !== '') {
                        highlightSearchTerms(card, query);
                    } else {
                        removeHighlights(card);
                    }
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Update search results message
            if (query !== '') {
                resultsContainer.innerHTML = `
                    <div class="bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg mb-6">
                        <strong>Search Results:</strong> Found ${visibleCount} item(s) matching "${query}"
                        ${visibleCount === 0 ? ' - Try a different search term.' : ''}
                    </div>
                `;
            } else {
                resultsContainer.innerHTML = '';
            }
        }

        function highlightSearchTerms(card, query) {
            const nameElement = card.querySelector('.item-name');
            const descriptionElement = card.querySelector('.item-description');
            
            if (nameElement) {
                highlightText(nameElement, query);
            }
            if (descriptionElement) {
                highlightText(descriptionElement, query);
            }
        }

        function highlightText(element, query) {
            const originalText = element.getAttribute('data-original-text') || element.textContent;
            element.setAttribute('data-original-text', originalText);
            
            const regex = new RegExp(`(${query})`, 'gi');
            const highlightedText = originalText.replace(regex, '<span class="search-results-highlight">$1</span>');
            element.innerHTML = highlightedText;
        }

        function removeHighlights(card) {
            const elements = card.querySelectorAll('[data-original-text]');
            elements.forEach(element => {
                element.textContent = element.getAttribute('data-original-text');
                element.removeAttribute('data-original-text');
            });
        }

        function clearSearch() {
            document.getElementById('search-bar').value = '';
            performSearch();
        }

        // Enhanced form submission with better error handling
        async function submitForm(formData, isUpdate = false, itemId = null) {
            const submitButton = document.querySelector(`#${isUpdate ? 'update' : 'add'}-item-form button[type="submit"]`);
            const originalText = submitButton.textContent;
            
            try {
                submitButton.disabled = true;
                submitButton.classList.add('loading');
                submitButton.textContent = isUpdate ? 'Updating...' : 'Adding...';
                
                const url = isUpdate ? `/api/spareparts/${itemId}/with-image` : '/api/spareparts/with-image';
                const method = isUpdate ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    body: formData
                });
                  if (response.ok) {
                    const result = await response.json();
                    showSuccessMessage(isUpdate ? 'Item updated successfully!' : 'Item added successfully!');
                    
                    // Refresh statistics immediately after successful operation
                    await refreshStatisticsFromAPI();
                    
                    if (isUpdate) {
                        closeUpdateModal();
                    } else {
                        document.getElementById('add-item-form').reset();
                        clearImagePreview();
                    }
                    
                    // Refresh the page to show updated data
                    setTimeout(() => window.location.reload(), 1000);
                    
                } else {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Server error');
                }
                
            } catch (error) {
                console.error('Form submission error:', error);
                showErrorMessage(error.message || 'Failed to submit form');
            } finally {
                submitButton.disabled = false;
                submitButton.classList.remove('loading');
                submitButton.textContent = originalText;
            }
        }

        function showSuccessMessage(message) {
            const container = document.getElementById('search-results-container');
            container.innerHTML = `
                <div class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-6 animate-fade-in">
                    <strong>‚úÖ Success:</strong> ${message}
                </div>
            `;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        function showErrorMessage(message) {
            const container = document.getElementById('search-results-container');
            container.innerHTML = `
                <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 animate-fade-in">
                    <strong>‚ùå Error:</strong> ${message}
                </div>
            `;
        }        // Enhanced delete function with better confirmation
        async function deleteItem(itemId, itemName) {
            if (!isAdmin) {
                showErrorMessage('Access denied. Only administrators can delete items.');
                return;
            }

            const confirmed = confirm(`üóëÔ∏è Are you sure you want to delete "${itemName}"?\n\nThis action cannot be undone.`);
            if (!confirmed) return;

            try {
                const response = await fetch(`/api/spareparts/${itemId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    showSuccessMessage(`"${itemName}" has been deleted successfully!`);
                    // Refresh statistics after deletion
                    await refreshStatisticsFromAPI();
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Failed to delete item');
                }
            } catch (error) {
                console.error('Delete error:', error);
                showErrorMessage(error.message || 'Failed to delete item');
            }
        }

        // Statistics API Integration Functions
        async function refreshStatisticsFromAPI() {
            console.log('Refreshing statistics from API...');
            try {
                // Show loading state on statistics cards
                showStatisticsLoading(true);
                
                const response = await fetch('/api/spareparts/statistics');
                if (response.ok) {
                    const stats = await response.json();
                    console.log('API Statistics received:', stats);
                    
                    // Update DOM elements with API data
                    updateStatisticsDisplay(stats);
                    
                    console.log('‚úÖ Statistics updated successfully from API');
                    
                    // Update database status to show stats were refreshed
                    updateDatabaseStatus('connected', `Stats Updated (${stats.lastUpdated || new Date().toLocaleString()})`);
                } else {
                    console.error('Failed to fetch statistics from API:', response.status);
                    showErrorMessage('Failed to refresh statistics from server');
                    updateDatabaseStatus('error', 'Stats API Error');
                }
            } catch (error) {
                console.error('Error refreshing statistics from API:', error);
                showErrorMessage('Network error while refreshing statistics');
                updateDatabaseStatus('error', 'Stats API Failed');
            } finally {
                // Hide loading state
                showStatisticsLoading(false);
            }
        }        function updateStatisticsDisplay(stats) {
            const totalItemsEl = document.getElementById('total-items');
            const totalValueEl = document.getElementById('total-value');
            const lowStockEl = document.getElementById('low-stock');
            const avgPriceEl = document.getElementById('avg-price');
            const itemsCountBadge = document.getElementById('items-count-badge');
            
            // Update with formatted values from API
            if (totalItemsEl) {
                totalItemsEl.textContent = stats.totalItems || 0;
                totalItemsEl.setAttribute('data-original', stats.totalItems || 0);
            }
            if (totalValueEl) totalValueEl.textContent = stats.formattedTotalValue || '0.00';
            if (lowStockEl) lowStockEl.textContent = stats.lowStockItems || 0;
            if (avgPriceEl) avgPriceEl.textContent = stats.formattedAveragePrice || '0.00';
            if (itemsCountBadge) itemsCountBadge.textContent = stats.totalItems || 0;
            
            // Add animation to show the update
            [totalItemsEl, totalValueEl, lowStockEl, avgPriceEl, itemsCountBadge].forEach(el => {
                if (el) {
                    el.classList.add('animate-pulse');
                    setTimeout(() => el.classList.remove('animate-pulse'), 1000);
                }
            });
        }

        function showStatisticsLoading(isLoading) {
            const statisticsCards = document.querySelectorAll('#stats-section .text-4xl');
            statisticsCards.forEach(card => {
                if (isLoading) {
                    card.classList.add('animate-pulse', 'text-gray-400');
                    card.dataset.originalText = card.textContent;
                    card.textContent = '...';
                } else {
                    card.classList.remove('animate-pulse', 'text-gray-400');
                    if (card.dataset.originalText && card.textContent === '...') {
                        card.textContent = card.dataset.originalText;
                    }
                }
            });
        }

        function updateDatabaseStatus(status, text) {
            const statusDot = document.getElementById('db-status');
            const statusText = document.getElementById('db-status-text');
            
            if (statusText) statusText.textContent = text;
            
            if (statusDot) {
                switch(status) {
                    case 'connected':
                        statusDot.className = 'w-3 h-3 rounded-full bg-green-500 animate-pulse';
                        break;
                    case 'connecting':
                        statusDot.className = 'w-3 h-3 rounded-full bg-yellow-500 animate-pulse';
                        break;
                    case 'error':
                        statusDot.className = 'w-3 h-3 rounded-full bg-red-500 animate-pulse';
                        break;
                }
            }
        }

        // Mobile Menu Functionality with null checks
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-menu-overlay');
            const closeMobileMenu = document.getElementById('close-mobile-menu');

            function openMobileMenu() {
                if (sidebar && overlay) {
                    sidebar.classList.remove('-translate-x-full');
                    overlay.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                }
            }

            function closeMobileMenuFunc() {
                if (sidebar && overlay) {
                    sidebar.classList.add('-translate-x-full');
                    overlay.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }
            }

            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', openMobileMenu);
            }

            if (closeMobileMenu) {
                closeMobileMenu.addEventListener('click', closeMobileMenuFunc);
            }

            if (overlay) {
                overlay.addEventListener('click', closeMobileMenuFunc);
            }

            // Close mobile menu when nav item is clicked
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    if (window.innerWidth < 768) { // Only on mobile
                        closeMobileMenuFunc();
                    }
                });
            });

            // Handle window resize
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 768) {
                    closeMobileMenuFunc();
                }
            });

            // Initialize navigation functionality
            initializeNavigation();
            
            // Initialize image upload functionality
            initializeImageUpload();

            // Initialize search functionality
            const searchButton = document.getElementById('search-button');
            const clearButton = document.getElementById('clear-search-button');
            const searchBar = document.getElementById('search-bar');

            if (searchButton) {
                searchButton.addEventListener('click', performSearch);
            }

            if (clearButton) {
                clearButton.addEventListener('click', clearSearch);
            }

            if (searchBar) {
                searchBar.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
                
                // Real-time search with debouncing
                let searchTimeout;
                searchBar.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(performSearch, 300);
                });
            }

            // Initialize form submissions
            const addForm = document.getElementById('add-item-form');
            if (addForm) {
                addForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData();
                    formData.append('name', document.getElementById('item-name').value);
                    formData.append('description', document.getElementById('item-description').value);
                    formData.append('price', document.getElementById('item-price').value);
                    formData.append('quantity', document.getElementById('item-quantity').value);
                    formData.append('currency', document.getElementById('item-currency').value);
                    
                    const imageFile = document.getElementById('item-image').files[0];
                    if (imageFile) {
                        formData.append('image', imageFile);
                    }
                    
                    await submitForm(formData, false);
                });
            }

            const updateForm = document.getElementById('update-item-form');
            if (updateForm) {
                updateForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const itemId = document.getElementById('update-item-id').value;
                    const formData = new FormData();
                    formData.append('name', document.getElementById('update-item-name').value);
                    formData.append('description', document.getElementById('update-item-description').value);
                    formData.append('price', document.getElementById('update-item-price').value);
                    formData.append('quantity', document.getElementById('update-item-quantity').value);
                    formData.append('currency', document.getElementById('update-item-currency').value);
                    
                    const imageFile = document.getElementById('update-item-image').files[0];
                    if (imageFile) {
                        formData.append('image', imageFile);
                    }
                    
                    await submitForm(formData, true, itemId);
                });
            }

            // Quick action buttons
            const quickAddButton = document.getElementById('quick-add-item');
            if (quickAddButton) {
                quickAddButton.addEventListener('click', function() {
                    scrollToElement('add-item-form');
                    document.getElementById('item-name').focus();
                });
            }

            const quickSearchButton = document.getElementById('quick-search');
            if (quickSearchButton) {
                quickSearchButton.addEventListener('click', function() {
                    document.getElementById('search-bar').focus();
                });
            }

            // Update last updated time
            const lastUpdated = document.getElementById('last-updated');
            if (lastUpdated) {
                lastUpdated.textContent = new Date().toLocaleString();
            }            // Initialize database status
            const dbStatus = document.getElementById('db-status');
            const dbStatusText = document.getElementById('db-status-text');
            if (dbStatus && dbStatusText) {
                dbStatus.className = 'w-3 h-3 rounded-full bg-green-500 animate-pulse';
                dbStatusText.textContent = 'Connected';
            }

            // Load initial statistics from API
            console.log('Loading initial statistics from API...');
            refreshStatisticsFromAPI();

            // Setup periodic refresh of statistics (every 30 seconds)
            setInterval(refreshStatisticsFromAPI, 30000);

            console.log('‚úÖ Dashboard initialized successfully');
        });
    </script>
</body>
</html>
